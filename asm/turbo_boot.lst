                      (   turbo_boot.asm):00001         ; [TURBO9_HEADER_START]
                      (   turbo_boot.asm):00002         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00003         ;                          Turbo9 Microprocessor IP
                      (   turbo_boot.asm):00004         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00005         ; Website: www.turbo9.org
                      (   turbo_boot.asm):00006         ; Contact: team[at]turbo9[dot]org
                      (   turbo_boot.asm):00007         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00008         ; [TURBO9_LICENSE_START]
                      (   turbo_boot.asm):00009         ; BSD-1-Clause
                      (   turbo_boot.asm):00010         ;
                      (   turbo_boot.asm):00011         ; Copyright (c) 2020-2023
                      (   turbo_boot.asm):00012         ; Kevin Phillipson
                      (   turbo_boot.asm):00013         ; Michael Rywalt
                      (   turbo_boot.asm):00014         ; All rights reserved.
                      (   turbo_boot.asm):00015         ;
                      (   turbo_boot.asm):00016         ; Redistribution and use in source and binary forms, with or without
                      (   turbo_boot.asm):00017         ; modification, are permitted provided that the following conditions are met:
                      (   turbo_boot.asm):00018         ;
                      (   turbo_boot.asm):00019         ; 1. Redistributions of source code must retain the above copyright notice,
                      (   turbo_boot.asm):00020         ;    this list of conditions and the following disclaimer.
                      (   turbo_boot.asm):00021         ;
                      (   turbo_boot.asm):00022         ; THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
                      (   turbo_boot.asm):00023         ; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
                      (   turbo_boot.asm):00024         ; IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
                      (   turbo_boot.asm):00025         ; ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDERS AND CONTRIBUTORS BE
                      (   turbo_boot.asm):00026         ; LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
                      (   turbo_boot.asm):00027         ; CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
                      (   turbo_boot.asm):00028         ; SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
                      (   turbo_boot.asm):00029         ; INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
                      (   turbo_boot.asm):00030         ; CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
                      (   turbo_boot.asm):00031         ; ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
                      (   turbo_boot.asm):00032         ; POSSIBILITY OF SUCH DAMAGE.
                      (   turbo_boot.asm):00033         ; [TURBO9_LICENSE_END]
                      (   turbo_boot.asm):00034         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00035         ; Engineer:
                      (   turbo_boot.asm):00036         ; Description:
                      (   turbo_boot.asm):00037         ;
                      (   turbo_boot.asm):00038         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00039         ; History:
                      (   turbo_boot.asm):00040         ; 07.14.2023 - Kevin Phillipson
                      (   turbo_boot.asm):00041         ;   File header added
                      (   turbo_boot.asm):00042         ;
                      (   turbo_boot.asm):00043         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00044         ; [TURBO9_HEADER_END]
                      (   turbo_boot.asm):00045         ;
                      (   turbo_boot.asm):00046         ; Turbo9 S19 Bootloader
                      (   turbo_boot.asm):00047         ;
                      (   turbo_boot.asm):00048         ; Kevin Phillipson
                      (   turbo_boot.asm):00049         ;
                      (   turbo_boot.asm):00050         
     0000             (   turbo_boot.asm):00051         output_port equ   $0000
     0002             (   turbo_boot.asm):00052         acia_data   equ   $0002
     0003             (   turbo_boot.asm):00053         acia_status equ   $0003
     FE00             (   turbo_boot.asm):00054         boot_start  equ   $fe00  ; bootloader location
     FE00             (   turbo_boot.asm):00055         boot_stack  equ   $fe00  ; stack location
     8000             (   turbo_boot.asm):00056         prog_start  equ   $8000  ; loaded program should start here
     000A             (   turbo_boot.asm):00057         LF          equ   $0a
                      (   turbo_boot.asm):00058         
                      (   turbo_boot.asm):00059         
                      (   turbo_boot.asm):00060         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00061         ;                            Main Program
                      (   turbo_boot.asm):00062         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00063         
                      (   turbo_boot.asm):00064           org   boot_start
                      (   turbo_boot.asm):00065         
FE00 7F0000           (   turbo_boot.asm):00066           clr   >output_port  ; clear outport to communicate with TB
                      (   turbo_boot.asm):00067         
FE03 10CEFE00         (   turbo_boot.asm):00068           lds   #boot_stack 
                      (   turbo_boot.asm):00069         
FE07 8EFF0F           (   turbo_boot.asm):00070           ldx   #prompt
FE0A BDFF89           (   turbo_boot.asm):00071           jsr   print_x
                      (   turbo_boot.asm):00072         
FE0D 10210086         (   turbo_boot.asm):00073           lbrn   call_prog_start  ; sed in asm32k will change this to bra for sim_boot.asm
                      (   turbo_boot.asm):00074         
                      (   turbo_boot.asm):00075           ; A = general purpose
                      (   turbo_boot.asm):00076           ; S = stack pointer
                      (   turbo_boot.asm):00077         
                      (   turbo_boot.asm):00078           ; B = byte_cnt,     S1 record byte count
                      (   turbo_boot.asm):00079           ; X = checksum,
                      (   turbo_boot.asm):00080           ; Y = write_addr,   Write address
                      (   turbo_boot.asm):00081           ; U = total_bytes,  Total bytes written
                      (   turbo_boot.asm):00082           
FE11 CE0000           (   turbo_boot.asm):00083           ldu   #$0000        ; clear total_bytes
FE14 8E0000           (   turbo_boot.asm):00084           ldx   #$0000        ; clear checksum
                      (   turbo_boot.asm):00085         
FE17                  (   turbo_boot.asm):00086         main_loop
FE17 BDFED8           (   turbo_boot.asm):00087           jsr   getchar_a
                      (   turbo_boot.asm):00088         
FE1A 8153             (   turbo_boot.asm):00089           cmpa  #'S'
FE1C 26F9             (   turbo_boot.asm):00090           bne   main_loop
                      (   turbo_boot.asm):00091         
FE1E BDFED8           (   turbo_boot.asm):00092           jsr   getchar_a
                      (   turbo_boot.asm):00093         
FE21 8131             (   turbo_boot.asm):00094           cmpa  #'1'
FE23 2706             (   turbo_boot.asm):00095           beq   s1_record
                      (   turbo_boot.asm):00096         
FE25 8139             (   turbo_boot.asm):00097           cmpa  #'9'
FE27 2745             (   turbo_boot.asm):00098           beq   s9_record
                      (   turbo_boot.asm):00099         
FE29 20EC             (   turbo_boot.asm):00100           bra   main_loop
                      (   turbo_boot.asm):00101         
FE2B                  (   turbo_boot.asm):00102         s1_record
FE2B 3084             (   turbo_boot.asm):00103           leax  ,x            ; checksum still ok?
FE2D 26E8             (   turbo_boot.asm):00104           bne   main_loop
FE2F 862E             (   turbo_boot.asm):00105           lda   #'.'
FE31 BDFEB0           (   turbo_boot.asm):00106           jsr   putchar_a     ; Print progress bar
FE34 BDFFB9           (   turbo_boot.asm):00107           jsr   gethex_byte   ; Read length
FE37 3086             (   turbo_boot.asm):00108           leax  a,x           ; add_checksum
FE39 8003             (   turbo_boot.asm):00109           suba  #3            ; minus 16bit address & checksum equals number of data bytes
FE3B A7E2             (   turbo_boot.asm):00110           sta   ,-s           ; push A (byte_cnt)
FE3D BDFFB9           (   turbo_boot.asm):00111           jsr   gethex_byte
FE40 3086             (   turbo_boot.asm):00112           leax  a,x           ; add_checksum
FE42 1F89             (   turbo_boot.asm):00113           tfr   a,b           ; put write_addr[15:8] in B
FE44 BDFFB9           (   turbo_boot.asm):00114           jsr   gethex_byte
FE47 3086             (   turbo_boot.asm):00115           leax  a,x           ; add_checksum
FE49 1E89             (   turbo_boot.asm):00116           exg   a,b           ; D = write_addr
FE4B 1F02             (   turbo_boot.asm):00117           tfr   d,y           ; Y = write_addr
FE4D E6E0             (   turbo_boot.asm):00118           ldb   ,s+           ; pull B (byte_cnt)
                      (   turbo_boot.asm):00119           ;
FE4F                  (   turbo_boot.asm):00120         s1r_loop
FE4F 5A               (   turbo_boot.asm):00121           decb                ; dec byte_cnt
FE50 2B0B             (   turbo_boot.asm):00122           bmi   s1r_checkit
FE52 BDFFB9           (   turbo_boot.asm):00123           jsr   gethex_byte
FE55 3086             (   turbo_boot.asm):00124           leax  a,x           ; add_checksum
FE57 A7A0             (   turbo_boot.asm):00125           sta   ,y+           ; write byte to write_addr; write_addr + 1
FE59 3341             (   turbo_boot.asm):00126           leau  1,u           ; U = total_bytes + 1
FE5B 20F2             (   turbo_boot.asm):00127           bra   s1r_loop
                      (   turbo_boot.asm):00128           ;
FE5D                  (   turbo_boot.asm):00129         s1r_checkit
                      (   turbo_boot.asm):00130           ; the S1 checksum should equal the one's complement of our running checksum in x[7:0]
FE5D BDFFB9           (   turbo_boot.asm):00131           jsr   gethex_byte   ; read S1 checksum
FE60 A7E2             (   turbo_boot.asm):00132           sta   ,-s           ; push S1 checksum onto stack
FE62 1F10             (   turbo_boot.asm):00133           tfr   x,d
FE64 E8E4             (   turbo_boot.asm):00134           eorb  ,s            ; B = $FF if correct
FE66 5C               (   turbo_boot.asm):00135           incb                ; B = $00 if correct
FE67 4F               (   turbo_boot.asm):00136           clra
FE68 1F01             (   turbo_boot.asm):00137           tfr   d,x           ; X = $0000 if correct
FE6A 3261             (   turbo_boot.asm):00138           leas  1,s           ; clean up stack
FE6C 20A9             (   turbo_boot.asm):00139           bra   main_loop
                      (   turbo_boot.asm):00140         
                      (   turbo_boot.asm):00141         
FE6E                  (   turbo_boot.asm):00142         s9_record
FE6E 3084             (   turbo_boot.asm):00143           leax  ,x            ; checksum ok?
FE70 2709             (   turbo_boot.asm):00144           beq   s9r_good_load
FE72 8EFF2F           (   turbo_boot.asm):00145           ldx   #load_bad
FE75 BDFF89           (   turbo_boot.asm):00146           jsr   print_x
FE78 7EFE00           (   turbo_boot.asm):00147           jmp   boot_start
FE7B                  (   turbo_boot.asm):00148         s9r_good_load
FE7B 8EFF3F           (   turbo_boot.asm):00149           ldx   #load_good0
FE7E BDFF89           (   turbo_boot.asm):00150           jsr   print_x
FE81 1F30             (   turbo_boot.asm):00151           tfr   u,d           ; A:B = total_bytes
FE83 BDFFD3           (   turbo_boot.asm):00152           jsr   puthex_16bit
FE86 8EFF51           (   turbo_boot.asm):00153           ldx   #load_good1
FE89 BDFF89           (   turbo_boot.asm):00154           jsr   print_x
FE8C CC8000           (   turbo_boot.asm):00155           ldd   #prog_start
FE8F BDFFD3           (   turbo_boot.asm):00156           jsr   puthex_16bit
FE92 860A             (   turbo_boot.asm):00157           lda   #LF
FE94 BDFEB0           (   turbo_boot.asm):00158           jsr   putchar_a
                      (   turbo_boot.asm):00159         
FE97                  (   turbo_boot.asm):00160         call_prog_start
FE97 7C0000           (   turbo_boot.asm):00161           inc   >output_port  ; set outport[0] = 1 to tell TB test has begun 
FE9A BD8000           (   turbo_boot.asm):00162           jsr  prog_start  
                      (   turbo_boot.asm):00163         
FE9D                  (   turbo_boot.asm):00164         boot_return
FE9D 8EFF6D           (   turbo_boot.asm):00165           ldx   #return_msg
FEA0 BDFF89           (   turbo_boot.asm):00166           jsr   print_x
FEA3 B60000           (   turbo_boot.asm):00167           lda   >output_port
FEA6 8A80             (   turbo_boot.asm):00168           ora   #$80
FEA8 B70000           (   turbo_boot.asm):00169           sta   >output_port  ;  set outport[7] = 1 to tell TB test has finished
FEAB                  (   turbo_boot.asm):00170         boot_sim_stop
FEAB 21FE             (   turbo_boot.asm):00171           brn   boot_sim_stop ; sed in asm32k will change this to bra for sim_boot.asm
FEAD 7EFE00           (   turbo_boot.asm):00172           jmp   boot_start
                      (   turbo_boot.asm):00173         
                      (   turbo_boot.asm):00174         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00175         
                      (   turbo_boot.asm):00176         
                      (   turbo_boot.asm):00177         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00178         ;                              Utility Functions
                      (   turbo_boot.asm):00179         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00180         
                      (   turbo_boot.asm):00181         
                      (   turbo_boot.asm):00182         ; ////////////////////// Send byte contained in A
                      (   turbo_boot.asm):00183         ;
FEB0                  (   turbo_boot.asm):00184         putchar_a
FEB0 7DFFED           (   turbo_boot.asm):00185           tst   >sim_detect
FEB3 2619             (   turbo_boot.asm):00186           bne   pca_sim_out
FEB5 810A             (   turbo_boot.asm):00187           cmpa  #$0a  ; LF
FEB7 2606             (   turbo_boot.asm):00188           bne   pca_not_lf
FEB9 860D             (   turbo_boot.asm):00189           lda   #$0d  ; CR
FEBB 8D02             (   turbo_boot.asm):00190           bsr   acia_putchar_a
FEBD 860A             (   turbo_boot.asm):00191           lda   #$0a  ; LF
FEBF                  (   turbo_boot.asm):00192         pca_not_lf
                      (   turbo_boot.asm):00193         ; fall through
FEBF                  (   turbo_boot.asm):00194         acia_putchar_a
FEBF 3402             (   turbo_boot.asm):00195           pshs  a
FEC1                  (   turbo_boot.asm):00196         apa_wait
FEC1 B60003           (   turbo_boot.asm):00197           lda   >acia_status
FEC4 8510             (   turbo_boot.asm):00198           bita  #$10
FEC6 27F9             (   turbo_boot.asm):00199           beq   apa_wait
FEC8 3502             (   turbo_boot.asm):00200           puls  a
FECA B70002           (   turbo_boot.asm):00201           sta   >acia_data
FECD 39               (   turbo_boot.asm):00202           rts
                      (   turbo_boot.asm):00203         
FECE                  (   turbo_boot.asm):00204         pca_sim_out
FECE B7FFEF           (   turbo_boot.asm):00205           sta   >sim_putchar_buf
FED1 7FFFEE           (   turbo_boot.asm):00206           clr   >sim_putchar_en
FED4 73FFEE           (   turbo_boot.asm):00207           com   >sim_putchar_en ; on bit0 posedge simulator writes to console.txt
FED7 39               (   turbo_boot.asm):00208           rts
                      (   turbo_boot.asm):00209         
                      (   turbo_boot.asm):00210         
                      (   turbo_boot.asm):00211         ; ////////////////////// Recieve byte and return in A
                      (   turbo_boot.asm):00212         ;
FED8                  (   turbo_boot.asm):00213         getchar_a
FED8 B60003           (   turbo_boot.asm):00214           lda   >acia_status
FEDB 8508             (   turbo_boot.asm):00215           bita  #$08
FEDD 27F9             (   turbo_boot.asm):00216           beq   getchar_a
FEDF B60002           (   turbo_boot.asm):00217           lda   >acia_data
FEE2 39               (   turbo_boot.asm):00218           rts
                      (   turbo_boot.asm):00219         
                      (   turbo_boot.asm):00220         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00221         
                      (   turbo_boot.asm):00222         
                      (   turbo_boot.asm):00223         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00224         ;                              SWI Handler
                      (   turbo_boot.asm):00225         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00226         
FEE3                  (   turbo_boot.asm):00227         swi_handler
FEE3 8104             (   turbo_boot.asm):00228           cmpa  #$04
FEE5 2606             (   turbo_boot.asm):00229           bne   swi_handler_3
FEE7 8DEF             (   turbo_boot.asm):00230           bsr   getchar_a
FEE9 A784             (   turbo_boot.asm):00231           sta   ,x
FEEB 35FF             (   turbo_boot.asm):00232           puls  pc,u,y,x,dp,b,a,cc
                      (   turbo_boot.asm):00233         
FEED                  (   turbo_boot.asm):00234         swi_handler_3
FEED 8103             (   turbo_boot.asm):00235           cmpa  #$03
FEEF 2606             (   turbo_boot.asm):00236           bne   swi_handler_2
FEF1 1F98             (   turbo_boot.asm):00237           tfr   b,a
FEF3 8DBB             (   turbo_boot.asm):00238           bsr   putchar_a
FEF5 35FF             (   turbo_boot.asm):00239           puls  pc,u,y,x,dp,b,a,cc
                      (   turbo_boot.asm):00240         
FEF7                  (   turbo_boot.asm):00241         swi_handler_2
FEF7 8102             (   turbo_boot.asm):00242           cmpa  #$02
FEF9 2608             (   turbo_boot.asm):00243           bne   swi_handler_1
FEFB 8EFF69           (   turbo_boot.asm):00244           ldx   #input_prompt
FEFE BDFF89           (   turbo_boot.asm):00245           jsr   print_x
FF01 35FF             (   turbo_boot.asm):00246           puls  pc,u,y,x,dp,b,a,cc
                      (   turbo_boot.asm):00247         
FF03                  (   turbo_boot.asm):00248         swi_handler_1
FF03 8101             (   turbo_boot.asm):00249           cmpa  #$01
FF05 2605             (   turbo_boot.asm):00250           bne   swi_handler_exit
FF07 BDFF89           (   turbo_boot.asm):00251           jsr   print_x
FF0A 35FF             (   turbo_boot.asm):00252           puls  pc,u,y,x,dp,b,a,cc
                      (   turbo_boot.asm):00253         
FF0C                  (   turbo_boot.asm):00254         swi_handler_exit
FF0C 7EFE9D           (   turbo_boot.asm):00255           jmp   boot_return
                      (   turbo_boot.asm):00256         
                      (   turbo_boot.asm):00257         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00258         
                      (   turbo_boot.asm):00259         
                      (   turbo_boot.asm):00260         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00261         ;                              Data Block
                      (   turbo_boot.asm):00262         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00263         
FF0F                  (   turbo_boot.asm):00264         prompt
FF0F 0A               (   turbo_boot.asm):00265           fcb  $0a
FF10 2F2F2F2054757262 (   turbo_boot.asm):00266           fcc  "/// Turbo9 S19 Bootloader ///"
     6F39205331392042
     6F6F746C6F616465
     72202F2F2F
FF2D 0A               (   turbo_boot.asm):00267           fcb  $0a
FF2E 00               (   turbo_boot.asm):00268           fcb  $00
                      (   turbo_boot.asm):00269         
FF2F                  (   turbo_boot.asm):00270         load_bad
FF2F 0A               (   turbo_boot.asm):00271           fcb  $0a
FF30 436865636B73756D (   turbo_boot.asm):00272           fcc  "Checksum FAIL"
     204641494C
FF3D 0A               (   turbo_boot.asm):00273           fcb  $0a
FF3E 00               (   turbo_boot.asm):00274           fcb  $00
                      (   turbo_boot.asm):00275         
FF3F                  (   turbo_boot.asm):00276         load_good0
FF3F 0A               (   turbo_boot.asm):00277           fcb  $0a
FF40 4279746573207265 (   turbo_boot.asm):00278           fcc  "Bytes received $"
     6365697665642024
FF50 00               (   turbo_boot.asm):00279           fcb  $00
                      (   turbo_boot.asm):00280         
FF51                  (   turbo_boot.asm):00281         load_good1
FF51 0A               (   turbo_boot.asm):00282           fcb  $0a
FF52 436865636B73756D (   turbo_boot.asm):00283           fcc  "Checksum PASS"
     2050415353
FF5F 0A               (   turbo_boot.asm):00284           fcb  $0a
FF60 4A535220746F2024 (   turbo_boot.asm):00285           fcc  "JSR to $"
FF68 00               (   turbo_boot.asm):00286           fcb  $00
                      (   turbo_boot.asm):00287         
FF69                  (   turbo_boot.asm):00288         input_prompt
FF69 424144           (   turbo_boot.asm):00289           fcc  "BAD"
FF6C 00               (   turbo_boot.asm):00290           fcb  $00
                      (   turbo_boot.asm):00291         
FF6D                  (   turbo_boot.asm):00292         return_msg
FF6D 0A               (   turbo_boot.asm):00293           fcb  $0a
FF6E 52657475726E6564 (   turbo_boot.asm):00294           fcc  "Returned to bootloader..."
     20746F20626F6F74
     6C6F616465722E2E
     2E
FF87 0A               (   turbo_boot.asm):00295           fcb  $0a
FF88 00               (   turbo_boot.asm):00296           fcb  $00
                      (   turbo_boot.asm):00297         
                      (   turbo_boot.asm):00298         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00299         
                      (   turbo_boot.asm):00300         
                      (   turbo_boot.asm):00301         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00302         ;                       Common I/O Function Library
                      (   turbo_boot.asm):00303         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00304           
                      (   turbo_boot.asm):00305           include   common_io.asm
                      (    common_io.asm):00001         ; [TURBO9_HEADER_START]
                      (    common_io.asm):00002         ; ////////////////////////////////////////////////////////////////////////////
                      (    common_io.asm):00003         ;                          Turbo9 Microprocessor IP
                      (    common_io.asm):00004         ; ////////////////////////////////////////////////////////////////////////////
                      (    common_io.asm):00005         ; Website: www.turbo9.org
                      (    common_io.asm):00006         ; Contact: team[at]turbo9[dot]org
                      (    common_io.asm):00007         ; ////////////////////////////////////////////////////////////////////////////
                      (    common_io.asm):00008         ; [TURBO9_LICENSE_START]
                      (    common_io.asm):00009         ; BSD-1-Clause
                      (    common_io.asm):00010         ;
                      (    common_io.asm):00011         ; Copyright (c) 2020-2023
                      (    common_io.asm):00012         ; Kevin Phillipson
                      (    common_io.asm):00013         ; Michael Rywalt
                      (    common_io.asm):00014         ; All rights reserved.
                      (    common_io.asm):00015         ;
                      (    common_io.asm):00016         ; Redistribution and use in source and binary forms, with or without
                      (    common_io.asm):00017         ; modification, are permitted provided that the following conditions are met:
                      (    common_io.asm):00018         ;
                      (    common_io.asm):00019         ; 1. Redistributions of source code must retain the above copyright notice,
                      (    common_io.asm):00020         ;    this list of conditions and the following disclaimer.
                      (    common_io.asm):00021         ;
                      (    common_io.asm):00022         ; THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
                      (    common_io.asm):00023         ; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
                      (    common_io.asm):00024         ; IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
                      (    common_io.asm):00025         ; ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDERS AND CONTRIBUTORS BE
                      (    common_io.asm):00026         ; LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
                      (    common_io.asm):00027         ; CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
                      (    common_io.asm):00028         ; SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
                      (    common_io.asm):00029         ; INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
                      (    common_io.asm):00030         ; CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
                      (    common_io.asm):00031         ; ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
                      (    common_io.asm):00032         ; POSSIBILITY OF SUCH DAMAGE.
                      (    common_io.asm):00033         ; [TURBO9_LICENSE_END]
                      (    common_io.asm):00034         ; ////////////////////////////////////////////////////////////////////////////
                      (    common_io.asm):00035         ; Engineer: Kevin Phillipson
                      (    common_io.asm):00036         ; Description: Input / Output Library
                      (    common_io.asm):00037         ;
                      (    common_io.asm):00038         ; ////////////////////////////////////////////////////////////////////////////
                      (    common_io.asm):00039         ; History:
                      (    common_io.asm):00040         ; 07.14.2023 - Kevin Phillipson
                      (    common_io.asm):00041         ;   File header added
                      (    common_io.asm):00042         ;
                      (    common_io.asm):00043         ; ////////////////////////////////////////////////////////////////////////////
                      (    common_io.asm):00044         ; [TURBO9_HEADER_END]
                      (    common_io.asm):00045         
                      (    common_io.asm):00046         ; ////////////////////////////////////////////////////////////////////////////
                      (    common_io.asm):00047         ;                             Common I/O Functions
                      (    common_io.asm):00048         ; ////////////////////////////////////////////////////////////////////////////
                      (    common_io.asm):00049         
                      (    common_io.asm):00050         ; You must provide a putchar_a & getchar_a function for this library.
                      (    common_io.asm):00051         ; Requirement for putchar_a & getchar_a
                      (    common_io.asm):00052         ;  - byte in A to be recieved / sent
                      (    common_io.asm):00053         ;  - all other registers need to be maintained through function call
                      (    common_io.asm):00054         ;
                      (    common_io.asm):00055         
                      (    common_io.asm):00056         
                      (    common_io.asm):00057         
                      (    common_io.asm):00058         ; ////////////////////// Print null terminated string pointed to by X
                      (    common_io.asm):00059         ;
FF89                  (    common_io.asm):00060         print_x
FF89 3412             (    common_io.asm):00061           pshs  a,x
FF8B                  (    common_io.asm):00062         apx_loop
FF8B A680             (    common_io.asm):00063           lda   ,x+
FF8D 2705             (    common_io.asm):00064           beq   apx_end
FF8F BDFEB0           (    common_io.asm):00065           jsr   putchar_a
FF92 20F7             (    common_io.asm):00066           bra   apx_loop
FF94                  (    common_io.asm):00067         apx_end
FF94 3592             (    common_io.asm):00068           puls  a,x,pc
                      (    common_io.asm):00069         
                      (    common_io.asm):00070         ; ////////////////////// Put Hex Digit
                      (    common_io.asm):00071         ;
FF96                  (    common_io.asm):00072         puthex_digit
FF96 3402             (    common_io.asm):00073           pshs  a
FF98 840F             (    common_io.asm):00074           anda  #$0f
FF9A 810A             (    common_io.asm):00075           cmpa  #$0a
FF9C 2504             (    common_io.asm):00076           blo   puthex_digit1
FF9E 8B37             (    common_io.asm):00077           adda  #$37
FFA0 2002             (    common_io.asm):00078           bra   puthex_digit2
FFA2                  (    common_io.asm):00079         puthex_digit1
FFA2 8B30             (    common_io.asm):00080           adda  #$30
FFA4                  (    common_io.asm):00081         puthex_digit2
FFA4 BDFEB0           (    common_io.asm):00082           jsr   putchar_a
FFA7 3582             (    common_io.asm):00083           puls  a,pc
                      (    common_io.asm):00084         
                      (    common_io.asm):00085         ; ////////////////////// Get Hex Digit
                      (    common_io.asm):00086         ;
                      (    common_io.asm):00087         ; Get hex digit and convert
                      (    common_io.asm):00088         ; to binary nibble. Return in A
                      (    common_io.asm):00089         ;
FFA9                  (    common_io.asm):00090         gethex_digit
FFA9 BDFED8           (    common_io.asm):00091           jsr   getchar_a
FFAC 8D2E             (    common_io.asm):00092           bsr   ucase_a
FFAE 8141             (    common_io.asm):00093           cmpa  #'A'         ; uppercase A to F?
FFB0 2404             (    common_io.asm):00094           bhs   ghd_AtoF
FFB2                  (    common_io.asm):00095         ghd_0to9
FFB2 8030             (    common_io.asm):00096           suba  #'0'         ; else 0 to 9
FFB4 2002             (    common_io.asm):00097           bra   ghd_done
FFB6                  (    common_io.asm):00098         ghd_AtoF
FFB6 8037             (    common_io.asm):00099           suba  #$37
FFB8                  (    common_io.asm):00100         ghd_done
FFB8 39               (    common_io.asm):00101           rts
                      (    common_io.asm):00102         
                      (    common_io.asm):00103         
                      (    common_io.asm):00104         ; ////////////////////// Get Hex Byte
                      (    common_io.asm):00105         ; 
                      (    common_io.asm):00106         ; Get 2 hex digit and convert
                      (    common_io.asm):00107         ; to binary byte. Return in A
                      (    common_io.asm):00108         ;
FFB9                  (    common_io.asm):00109         gethex_byte
FFB9 8DEE             (    common_io.asm):00110           bsr   gethex_digit
FFBB 48               (    common_io.asm):00111           lsla
FFBC 48               (    common_io.asm):00112           lsla
FFBD 48               (    common_io.asm):00113           lsla
FFBE 48               (    common_io.asm):00114           lsla
FFBF 3402             (    common_io.asm):00115           pshs  a
FFC1 8DE6             (    common_io.asm):00116           bsr   gethex_digit
FFC3 AAE0             (    common_io.asm):00117           ora   ,s+
FFC5 39               (    common_io.asm):00118           rts
                      (    common_io.asm):00119         
                      (    common_io.asm):00120         ; ////////////////////// Put Hex Byte
                      (    common_io.asm):00121         ;
                      (    common_io.asm):00122         ; Print hex value in A
                      (    common_io.asm):00123         ;
FFC6                  (    common_io.asm):00124         puthex_byte
FFC6 3402             (    common_io.asm):00125           pshs  a
FFC8 44               (    common_io.asm):00126           lsra
FFC9 44               (    common_io.asm):00127           lsra
FFCA 44               (    common_io.asm):00128           lsra
FFCB 44               (    common_io.asm):00129           lsra
FFCC 8DC8             (    common_io.asm):00130           bsr   puthex_digit
FFCE 3502             (    common_io.asm):00131           puls  a
FFD0 8DC4             (    common_io.asm):00132           bsr   puthex_digit
FFD2 39               (    common_io.asm):00133           rts
                      (    common_io.asm):00134         
                      (    common_io.asm):00135         ; ////////////////////// Put Hex 16bit
                      (    common_io.asm):00136         ;
                      (    common_io.asm):00137         ; Print hex value in D
                      (    common_io.asm):00138         ;
FFD3                  (    common_io.asm):00139         puthex_16bit
FFD3 8DF1             (    common_io.asm):00140           bsr   puthex_byte
FFD5 1E89             (    common_io.asm):00141           exg   a,b
FFD7 8DED             (    common_io.asm):00142           bsr   puthex_byte
FFD9 1E89             (    common_io.asm):00143           exg   a,b
FFDB 39               (    common_io.asm):00144           rts
                      (    common_io.asm):00145         
                      (    common_io.asm):00146         ; ////////////////////// Ucase A
                      (    common_io.asm):00147         ;
FFDC                  (    common_io.asm):00148         ucase_a
FFDC 8161             (    common_io.asm):00149           cmpa  #'a'
FFDE 2506             (    common_io.asm):00150           blo   uca_done
FFE0 817A             (    common_io.asm):00151           cmpa  #'z'
FFE2 2202             (    common_io.asm):00152           bhi   uca_done
FFE4 8020             (    common_io.asm):00153           suba  #$20
FFE6                  (    common_io.asm):00154         uca_done
FFE6 39               (    common_io.asm):00155           rts
                      (    common_io.asm):00156         
                      (    common_io.asm):00157         ; ////////////////////////////////////////////////////////////////////////////
                      (    common_io.asm):00158         
                      (    common_io.asm):00159         
                      (   turbo_boot.asm):00306         
                      (   turbo_boot.asm):00307         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00308         
                      (   turbo_boot.asm):00309         
                      (   turbo_boot.asm):00310         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00311         ;                     Simulation Output Interface
                      (   turbo_boot.asm):00312         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00313         
                      (   turbo_boot.asm):00314           org   boot_vector_table-3
FFED                  (   turbo_boot.asm):00315         sim_detect
FFED 00               (   turbo_boot.asm):00316           fcb   $00   //sed replace tag_sim_detect
FFEE                  (   turbo_boot.asm):00317         sim_putchar_en
FFEE 00               (   turbo_boot.asm):00318           fcb   $00 
FFEF                  (   turbo_boot.asm):00319         sim_putchar_buf
FFEF 00               (   turbo_boot.asm):00320           fcb   $00
                      (   turbo_boot.asm):00321         
                      (   turbo_boot.asm):00322         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00323         
                      (   turbo_boot.asm):00324         
                      (   turbo_boot.asm):00325         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00326         ;                      Reset / Interrupt Vector Table
                      (   turbo_boot.asm):00327         ; ////////////////////////////////////////////////////////////////////////////
                      (   turbo_boot.asm):00328         
                      (   turbo_boot.asm):00329           org  $fff0
FFF0                  (   turbo_boot.asm):00330         boot_vector_table:
                      (   turbo_boot.asm):00331         
FFF0                  (   turbo_boot.asm):00332         boot_reserved_vector:
FFF0 FE00             (   turbo_boot.asm):00333           fdb boot_start
FFF2                  (   turbo_boot.asm):00334         boot_swi3_vector:
FFF2 FE00             (   turbo_boot.asm):00335           fdb boot_start
FFF4                  (   turbo_boot.asm):00336         boot_swi2_vector:
FFF4 FE00             (   turbo_boot.asm):00337           fdb boot_start
FFF6                  (   turbo_boot.asm):00338         boot_firq_vector:
FFF6 FE00             (   turbo_boot.asm):00339           fdb boot_start
FFF8                  (   turbo_boot.asm):00340         boot_irq_vector:
FFF8 FE00             (   turbo_boot.asm):00341           fdb boot_start
FFFA                  (   turbo_boot.asm):00342         boot_swi_vector:
FFFA FEE3             (   turbo_boot.asm):00343           fdb swi_handler
FFFC                  (   turbo_boot.asm):00344         boot_nmi_vector:
FFFC FE00             (   turbo_boot.asm):00345           fdb boot_start
FFFE                  (   turbo_boot.asm):00346         boot_reset_vector:
FFFE FE00             (   turbo_boot.asm):00347           fdb boot_start
                      (   turbo_boot.asm):00348         
                      (   turbo_boot.asm):00349         ; ////////////////////////////////////////////////////////////////////////////
